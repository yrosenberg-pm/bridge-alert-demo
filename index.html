<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Road Warrior">
    <link rel="apple-touch-icon" href="https://yrosenberg-pm.github.io/bridge-alert-demo/icon.png">
    <link rel="icon" href="https://yrosenberg-pm.github.io/bridge-alert-demo/icon.png">
    <title>Road Warrior - Bridge Alert System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0e1a;
            color: white;
            height: 100vh;
            overflow: hidden;
            position: fixed;
            width: 100%;
        }

        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            padding-bottom: env(safe-area-inset-bottom);
        }

        .header {
            padding: max(20px, env(safe-area-inset-top)) 20px 16px;
            background: linear-gradient(180deg, rgba(10, 14, 26, 0.95) 0%, rgba(10, 14, 26, 0) 100%);
            position: relative;
            z-index: 10;
            flex-shrink: 0;
        }

        .brand {
            font-size: 28px;
            font-weight: 800;
            letter-spacing: -0.5px;
            background: linear-gradient(135deg, #60a5fa 0%, #a78bfa 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 4px;
        }

        .tagline {
            font-size: 13px;
            color: #64748b;
            font-weight: 500;
        }

        .status-bar {
            display: flex;
            align-items: center;
            gap: 8px;
            position: absolute;
            top: max(24px, env(safe-area-inset-top));
            right: 20px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #64748b;
            transition: all 0.3s;
        }

        .status-dot.active {
            background: #22c55e;
            box-shadow: 0 0 12px rgba(34, 197, 94, 0.6);
        }

        .status-text {
            font-size: 12px;
            font-weight: 600;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-text.active {
            color: #22c55e;
        }

        .version {
            position: absolute;
            top: max(48px, calc(env(safe-area-inset-top) + 28px));
            right: 20px;
            font-size: 9px;
            color: #475569;
            font-weight: 500;
            letter-spacing: 0.3px;
        }

        .vehicle-card {
            margin: 0 20px 12px;
            padding: 12px 16px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(168, 85, 247, 0.05) 100%);
            border-radius: 16px;
            border: 1px solid rgba(99, 102, 241, 0.2);
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .vehicle-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .vehicle-type {
            font-size: 14px;
            font-weight: 700;
            color: #e2e8f0;
        }

        .vehicle-spec {
            font-size: 13px;
            color: #94a3b8;
            font-weight: 500;
        }

        .edit-btn {
            padding: 6px 12px;
            background: rgba(96, 165, 250, 0.2);
            border: 1px solid rgba(96, 165, 250, 0.3);
            border-radius: 8px;
            color: #60a5fa;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: #1e293b;
            border-radius: 24px;
            padding: 24px;
            max-width: 400px;
            width: 100%;
            border: 1px solid rgba(99, 102, 241, 0.3);
        }

        .modal-header {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .input-group {
            margin-bottom: 16px;
        }

        .input-label {
            font-size: 13px;
            color: #94a3b8;
            font-weight: 600;
            margin-bottom: 8px;
            display: block;
        }

        .input-field {
            width: 100%;
            padding: 12px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 12px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            -webkit-appearance: none;
            appearance: none;
        }

        .input-field:focus {
            outline: none;
            border-color: #60a5fa;
            background: rgba(0, 0, 0, 0.5);
        }

        .modal-buttons {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        .modal-btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
        }

        .modal-btn:active {
            transform: scale(0.95);
        }

        .modal-btn.primary {
            background: linear-gradient(135deg, #60a5fa 0%, #a78bfa 100%);
            color: white;
        }

        .modal-btn.secondary {
            background: rgba(100, 116, 139, 0.2);
            color: #94a3b8;
        }

        .alerts-section {
            flex: 1;
            overflow-y: auto;
            padding: 0 20px 20px;
            -webkit-overflow-scrolling: touch;
            min-height: 0;
        }

        .alerts-section::-webkit-scrollbar {
            display: none;
        }

        .persistent-compass {
            margin: 0 20px 12px;
            padding: 16px;
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.95) 0%, rgba(15, 23, 42, 0.95) 100%);
            border-radius: 24px;
            border: 2px solid rgba(99, 102, 241, 0.4);
            flex-shrink: 0;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .persistent-compass.bridge-detected {
            border-color: rgba(239, 68, 68, 0.8);
            box-shadow: 0 0 40px rgba(239, 68, 68, 0.4), 0 8px 32px rgba(0, 0, 0, 0.4);
            animation: pulse-border 2s ease-in-out infinite;
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.15) 0%, rgba(30, 41, 59, 0.95) 100%);
        }

        .persistent-compass.bridge-detected.warning {
            border-color: rgba(249, 115, 22, 0.8);
            box-shadow: 0 0 40px rgba(249, 115, 22, 0.4), 0 8px 32px rgba(0, 0, 0, 0.4);
            animation: pulse-border-warning 2s ease-in-out infinite;
            background: linear-gradient(135deg, rgba(249, 115, 22, 0.15) 0%, rgba(30, 41, 59, 0.95) 100%);
        }

        .persistent-compass.bridge-detected.caution {
            border-color: rgba(234, 179, 8, 0.8);
            box-shadow: 0 0 40px rgba(234, 179, 8, 0.4), 0 8px 32px rgba(0, 0, 0, 0.4);
            animation: pulse-border-caution 2s ease-in-out infinite;
            background: linear-gradient(135deg, rgba(234, 179, 8, 0.15) 0%, rgba(30, 41, 59, 0.95) 100%);
        }

        @keyframes pulse-border {
            0%, 100% {
                border-color: rgba(239, 68, 68, 0.8);
                box-shadow: 0 0 40px rgba(239, 68, 68, 0.4), 0 8px 32px rgba(0, 0, 0, 0.4);
            }
            50% {
                border-color: rgba(239, 68, 68, 1);
                box-shadow: 0 0 60px rgba(239, 68, 68, 0.6), 0 8px 32px rgba(0, 0, 0, 0.4);
            }
        }

        @keyframes pulse-border-warning {
            0%, 100% {
                border-color: rgba(249, 115, 22, 0.8);
                box-shadow: 0 0 40px rgba(249, 115, 22, 0.4), 0 8px 32px rgba(0, 0, 0, 0.4);
            }
            50% {
                border-color: rgba(249, 115, 22, 1);
                box-shadow: 0 0 60px rgba(249, 115, 22, 0.6), 0 8px 32px rgba(0, 0, 0, 0.4);
            }
        }

        @keyframes pulse-border-caution {
            0%, 100% {
                border-color: rgba(234, 179, 8, 0.8);
                box-shadow: 0 0 40px rgba(234, 179, 8, 0.4), 0 8px 32px rgba(0, 0, 0, 0.4);
            }
            50% {
                border-color: rgba(234, 179, 8, 1);
                box-shadow: 0 0 60px rgba(234, 179, 8, 0.6), 0 8px 32px rgba(0, 0, 0, 0.4);
            }
        }

        .compass-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }

        .compass-status-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-pulse {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #22c55e;
            box-shadow: 0 0 8px rgba(34, 197, 94, 0.6);
            animation: pulse-dot 2s ease-in-out infinite;
        }

        .status-pulse.alert {
            background: #ef4444;
            box-shadow: 0 0 12px rgba(239, 68, 68, 0.8);
            animation: pulse-dot-alert 1s ease-in-out infinite;
        }

        @keyframes pulse-dot {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes pulse-dot-alert {
            0%, 100% { 
                opacity: 1;
                transform: scale(1);
            }
            50% { 
                opacity: 0.6;
                transform: scale(1.2);
            }
        }

        .persistent-compass .compass-container {
            width: 90px;
            height: 90px;
            margin: 0 auto 4px;
            position: relative;
        }

        .compass-outer-ring {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: radial-gradient(circle at center, rgba(99, 102, 241, 0.1) 0%, transparent 70%);
            border: 3px solid rgba(100, 116, 139, 0.3);
        }

        .compass-inner-ring {
            position: absolute;
            width: 85%;
            height: 85%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border-radius: 50%;
            border: 2px solid rgba(100, 116, 139, 0.2);
        }

        .compass-rose {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            transition: transform 0.5s ease-out;
        }

        .compass-cardinal {
            position: absolute;
            font-size: 12px;
            font-weight: 900;
            color: #64748b;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .compass-cardinal.n {
            top: 2px;
            left: 50%;
            transform: translateX(-50%);
            color: #60a5fa;
            font-size: 16px;
        }

        .compass-cardinal.e {
            right: 3px;
            top: 50%;
            transform: translateY(-50%);
        }

        .compass-cardinal.s {
            bottom: 2px;
            left: 50%;
            transform: translateX(-50%);
        }

        .compass-cardinal.w {
            left: 3px;
            top: 50%;
            transform: translateY(-50%);
        }

        .compass-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 12px;
            height: 12px;
            background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%);
            border-radius: 50%;
            border: 2px solid #1e293b;
            box-shadow: 0 0 16px rgba(96, 165, 250, 0.6), inset 0 2px 4px rgba(255, 255, 255, 0.3);
            z-index: 3;
        }

        .compass-heading-arrow {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 3px;
            height: 36px;
            background: linear-gradient(180deg, #60a5fa 0%, rgba(96, 165, 250, 0.3) 100%);
            transform-origin: bottom center;
            transform: translate(-50%, -100%) rotate(0deg);
            border-radius: 3px 3px 0 0;
            z-index: 2;
            transition: transform 0.5s ease-out;
            box-shadow: 0 0 12px rgba(96, 165, 250, 0.5);
        }

        .compass-heading-arrow::before {
            content: '';
            position: absolute;
            top: -4px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 4px solid transparent;
            border-right: 4px solid transparent;
            border-bottom: 7px solid #60a5fa;
            filter: drop-shadow(0 0 8px rgba(96, 165, 250, 0.8));
        }

        .compass-bridge-arrow {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 4px;
            height: 40px;
            transform-origin: bottom center;
            transform: translate(-50%, -100%) rotate(0deg);
            z-index: 4;
            transition: transform 0.3s ease-out;
        }

        .compass-bridge-arrow::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 7px solid transparent;
            border-right: 7px solid transparent;
            border-bottom: 40px solid #ef4444;
            filter: drop-shadow(0 0 16px rgba(239, 68, 68, 0.9));
        }

        .compass-bridge-arrow.warning::before {
            border-bottom-color: #f97316;
            filter: drop-shadow(0 0 16px rgba(249, 115, 22, 0.9));
        }

        .compass-bridge-arrow.caution::before {
            border-bottom-color: #eab308;
            filter: drop-shadow(0 0 16px rgba(234, 179, 8, 0.9));
        }

        .compass-bridge-arrow.critical::before {
            animation: pulse-arrow 0.8s ease-in-out infinite;
        }

        @keyframes pulse-arrow {
            0%, 100% { 
                opacity: 1;
                filter: drop-shadow(0 0 16px rgba(239, 68, 68, 0.9));
            }
            50% { 
                opacity: 0.6;
                filter: drop-shadow(0 0 24px rgba(239, 68, 68, 1));
            }
        }

        .compass-info {
            text-align: center;
        }

        .compass-distance {
            font-size: 28px;
            font-weight: 800;
            color: white;
            margin-bottom: 4px;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .compass-distance.alert {
            color: #ef4444;
        }

        .compass-bearing {
            font-size: 13px;
            color: #94a3b8;
            font-weight: 600;
        }

        .compass-bearing-value {
            color: #60a5fa;
            font-weight: 700;
        }

        .persistent-compass .compass-status {
            font-size: 11px;
            color: #94a3b8;
            text-transform: uppercase;
            font-weight: 700;
            letter-spacing: 1px;
        }

        .persistent-compass .compass-status.alert {
            color: #ef4444;
            font-size: 12px;
            animation: pulse-text 1s ease-in-out infinite;
        }

        @keyframes pulse-text {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .bridge-alert-banner {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.3) 0%, rgba(220, 38, 38, 0.2) 100%);
            border: 2px solid rgba(239, 68, 68, 0.6);
            border-radius: 12px;
            padding: 4px 8px;
            margin-bottom: 4px;
            display: none;
            text-align: center;
        }

        .bridge-alert-banner.warning {
            background: linear-gradient(135deg, rgba(249, 115, 22, 0.3) 0%, rgba(234, 88, 12, 0.2) 100%);
            border: 2px solid rgba(249, 115, 22, 0.6);
        }

        .bridge-alert-banner.caution {
            background: linear-gradient(135deg, rgba(234, 179, 8, 0.3) 0%, rgba(202, 138, 4, 0.2) 100%);
            border: 2px solid rgba(234, 179, 8, 0.6);
        }

        .bridge-alert-banner.active {
            display: block;
            animation: slide-in 0.3s ease-out;
        }

        @keyframes slide-in {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .bridge-alert-title {
            font-size: 10px;
            font-weight: 800;
            color: #fca5a5;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 2px;
        }

        .bridge-alert-banner.warning .bridge-alert-title {
            color: #fdba74;
        }

        .bridge-alert-banner.caution .bridge-alert-title {
            color: #fde047;
        }

        .bridge-alert-subtitle {
            font-size: 9px;
            color: #fecaca;
        }

        .bridge-alert-banner.warning .bridge-alert-subtitle {
            color: #fed7aa;
        }

        .bridge-alert-banner.caution .bridge-alert-subtitle {
            color: #fef08a;
        }

        .bridge-details {
            display: none;
            margin-top: 4px;
            padding: 4px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
        }

        .bridge-details.active {
            display: block;
        }

        .bridge-details-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }

        .bridge-name-compact {
            font-size: 10px;
            font-weight: 700;
            color: #e2e8f0;
            flex: 1;
        }

        .bridge-distance-compact {
            font-size: 14px;
            font-weight: 800;
            color: #ef4444;
            margin-left: 4px;
        }

        .bridge-details-content {
            display: block;
        }

        .clearance-compact {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 4px;
            margin-bottom: 4px;
            padding: 4px 8px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        .clearance-item-compact {
            text-align: center;
            flex: 1;
        }

        .clearance-label-compact {
            font-size: 7px;
            color: #64748b;
            text-transform: uppercase;
            font-weight: 700;
            letter-spacing: 0.3px;
            margin-bottom: 1px;
        }

        .clearance-value-compact {
            font-size: 12px;
            font-weight: 800;
            color: #e2e8f0;
        }

        .clearance-value-compact.danger {
            color: #ef4444;
        }

        .alert-action-compact {
            margin-top: 4px;
            padding: 5px;
            border-radius: 8px;
            font-size: 9px;
            font-weight: 700;
            text-align: center;
            background: rgba(239, 68, 68, 0.3);
            color: #fca5a5;
        }

        .bridge-details.warning .alert-action-compact {
            background: rgba(249, 115, 22, 0.3);
            color: #fdba74;
        }

        .bridge-details.caution .alert-action-compact {
            background: rgba(234, 179, 8, 0.3);
            color: #fde047;
        }

        .all-clear-message {
            text-align: center;
            padding: 8px 0;
            display: none;
        }

        .all-clear-message.active {
            display: block;
        }

        .all-clear-text {
            font-size: 14px;
            font-weight: 700;
            color: #22c55e;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .compass-location-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid rgba(100, 116, 139, 0.2);
        }

        .location-item {
            text-align: center;
        }

        .location-label {
            font-size: 9px;
            color: #64748b;
            text-transform: uppercase;
            font-weight: 700;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .location-value {
            font-size: 11px;
            color: #e2e8f0;
            font-weight: 600;
            font-family: 'Courier New', monospace;
        }

        .location-value.heading {
            font-size: 16px;
            color: #60a5fa;
            font-weight: 800;
        }

        .test-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px 16px;
            background: rgba(168, 85, 247, 0.9);
            border: 2px solid rgba(168, 85, 247, 1);
            border-radius: 12px;
            color: white;
            font-size: 11px;
            font-weight: 700;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(168, 85, 247, 0.5);
            transition: all 0.2s;
        }

        .test-btn:active {
            transform: scale(0.95);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="brand">Road Warrior</div>
            <div class="tagline">Bridge Clearance Alert System</div>
            <div class="status-bar">
                <div class="status-dot active" id="statusDot"></div>
                <div class="status-text active" id="statusText">Active</div>
            </div>
            <div class="version">v4.2</div>
        </div>

        <div class="vehicle-card">
            <div class="vehicle-info">
                <div>
                    <div class="vehicle-type">Class 8 Truck</div>
                    <div class="vehicle-spec" id="vehicleSpec">Height: 15.0 feet</div>
                </div>
            </div>
            <button class="edit-btn" id="editVehicleBtn">Edit</button>
        </div>

        <div class="persistent-compass" id="persistentCompass">
            <div class="compass-header">
                <div class="compass-status-group">
                    <div class="status-pulse" id="statusPulse"></div>
                    <div class="compass-status" id="compassStatus">Monitoring</div>
                </div>
            </div>
            <div class="bridge-alert-banner" id="bridgeAlertBanner">
                <div class="bridge-alert-title" id="bridgeAlertTitle">Bridge Detected</div>
                <div class="bridge-alert-subtitle" id="bridgeAlertSubtitle">Low clearance ahead</div>
            </div>
            <div class="compass-container">
                <div class="compass-outer-ring"></div>
                <div class="compass-inner-ring"></div>
                <div class="compass-rose" id="persistentCompassRose">
                    <div class="compass-cardinal n">N</div>
                    <div class="compass-cardinal e">E</div>
                    <div class="compass-cardinal s">S</div>
                    <div class="compass-cardinal w">W</div>
                </div>
                <div class="compass-heading-arrow" id="persistentHeadingArrow"></div>
                <div class="compass-bridge-arrow" id="persistentBridgeArrow" style="display: none;"></div>
                <div class="compass-center"></div>
            </div>
            <div class="compass-info" id="persistentCompassInfo" style="display: none;">
                <div class="compass-distance" id="persistentDistance">--</div>
                <div class="compass-bearing">
                    Bridge at <span class="compass-bearing-value" id="persistentBearing">---°</span>
                </div>
            </div>
            <div class="all-clear-message active" id="allClearMessage">
                <div class="all-clear-text">✓ All Clear</div>
            </div>
            <div class="compass-location-info" id="compassLocationInfo">
                <div class="location-item">
                    <div class="location-label">Heading</div>
                    <div class="location-value heading" id="headingDisplay">45°</div>
                </div>
                <div class="location-item">
                    <div class="location-label">Direction</div>
                    <div class="location-value heading" id="directionDisplay">NE</div>
                </div>
                <div class="location-item">
                    <div class="location-label">Latitude</div>
                    <div class="location-value" id="latDisplay">34.170467</div>
                </div>
                <div class="location-item">
                    <div class="location-label">Longitude</div>
                    <div class="location-value" id="lonDisplay">-118.501146</div>
                </div>
            </div>
            <div class="bridge-details" id="bridgeDetails">
                <div class="bridge-details-header">
                    <div class="bridge-name-compact" id="bridgeNameCompact">Bridge Name</div>
                    <div class="bridge-distance-compact" id="bridgeDistanceCompact">0.0 mi</div>
                </div>
                <div class="bridge-details-content">
                    <div class="clearance-compact">
                        <div class="clearance-item-compact">
                            <div class="clearance-label-compact">Bridge</div>
                            <div class="clearance-value-compact" id="bridgeClearanceValue">13.0'</div>
                        </div>
                        <div class="clearance-item-compact">
                            <div class="clearance-label-compact">Your Truck</div>
                            <div class="clearance-value-compact danger" id="vehicleClearanceValue">15.0'</div>
                        </div>
                        <div class="clearance-item-compact">
                            <div class="clearance-label-compact">Over By</div>
                            <div class="clearance-value-compact danger" id="overByValue">+2.0'</div>
                        </div>
                    </div>
                    <div class="alert-action-compact" id="alertActionCompact">STOP - REROUTE IMMEDIATELY</div>
                </div>
            </div>
        </div>

        <div class="alerts-section" id="alertsSection"></div>
    </div>

    <div class="modal-overlay" id="vehicleModal">
        <div class="modal">
            <div class="modal-header">Vehicle Settings</div>
            <div class="input-group">
                <label class="input-label">Height (feet)</label>
                <input type="number" class="input-field" id="heightInput" step="0.1" min="0" value="15.0">
            </div>
            <div class="modal-buttons">
                <button class="modal-btn secondary" id="cancelBtn">Cancel</button>
                <button class="modal-btn primary" id="saveBtn">Save</button>
            </div>
        </div>
    </div>

    <button class="test-btn" id="testBtn">Test</button>

    <script>
        let vehicleHeight = 15.0;
        let testMode = 0; // 0 = all clear, 1 = caution, 2 = warning, 3 = critical

        const statusDot = document.getElementById('statusDot');
        const statusText = document.getElementById('statusText');
        const vehicleSpec = document.getElementById('vehicleSpec');
        const editVehicleBtn = document.getElementById('editVehicleBtn');
        const vehicleModal = document.getElementById('vehicleModal');
        const heightInput = document.getElementById('heightInput');
        const cancelBtn = document.getElementById('cancelBtn');
        const saveBtn = document.getElementById('saveBtn');
        const persistentCompass = document.getElementById('persistentCompass');
        const persistentCompassRose = document.getElementById('persistentCompassRose');
        const persistentHeadingArrow = document.getElementById('persistentHeadingArrow');
        const persistentBridgeArrow = document.getElementById('persistentBridgeArrow');
        const persistentCompassInfo = document.getElementById('persistentCompassInfo');
        const persistentDistance = document.getElementById('persistentDistance');
        const persistentBearing = document.getElementById('persistentBearing');
        const compassStatus = document.getElementById('compassStatus');
        const statusPulse = document.getElementById('statusPulse');
        const bridgeAlertBanner = document.getElementById('bridgeAlertBanner');
        const bridgeAlertTitle = document.getElementById('bridgeAlertTitle');
        const bridgeAlertSubtitle = document.getElementById('bridgeAlertSubtitle');
        const headingDisplay = document.getElementById('headingDisplay');
        const directionDisplay = document.getElementById('directionDisplay');
        const latDisplay = document.getElementById('latDisplay');
        const lonDisplay = document.getElementById('lonDisplay');
        const bridgeDetails = document.getElementById('bridgeDetails');
        const bridgeNameCompact = document.getElementById('bridgeNameCompact');
        const bridgeDistanceCompact = document.getElementById('bridgeDistanceCompact');
        const bridgeClearanceValue = document.getElementById('bridgeClearanceValue');
        const vehicleClearanceValue = document.getElementById('vehicleClearanceValue');
        const overByValue = document.getElementById('overByValue');
        const alertActionCompact = document.getElementById('alertActionCompact');
        const allClearMessage = document.getElementById('allClearMessage');
        const compassLocationInfo = document.getElementById('compassLocationInfo');
        const testBtn = document.getElementById('testBtn');

        // Test scenarios
        const testScenarios = [
            {
                name: 'All Clear',
                level: null,
                distance: null,
                bearing: null,
                bridge: null
            },
            {
                name: 'Caution',
                level: 'caution',
                distance: 1.8,
                bearing: 45,
                bridge: {
                    name: 'Balboa Blvd over 101 Freeway',
                    clearance: 13.0,
                    location: 'Encino, CA'
                }
            },
            {
                name: 'Warning',
                level: 'warning',
                distance: 0.7,
                bearing: 90,
                bridge: {
                    name: 'Coldwater Canyon over 101 Freeway',
                    clearance: 13.0,
                    location: 'Studio City, CA'
                }
            },
            {
                name: 'Critical',
                level: 'critical',
                distance: 0.3,
                bearing: 135,
                bridge: {
                    name: 'Ventura Blvd under 405 Freeway',
                    clearance: 13.0,
                    location: 'Sherman Oaks, CA'
                }
            }
        ];

        testBtn.addEventListener('click', () => {
            testMode = (testMode + 1) % testScenarios.length;
            updateTestDisplay();
        });

        editVehicleBtn.addEventListener('click', () => {
            heightInput.value = vehicleHeight;
            vehicleModal.classList.add('active');
        });

        cancelBtn.addEventListener('click', () => {
            vehicleModal.classList.remove('active');
        });

        saveBtn.addEventListener('click', () => {
            const newHeight = parseFloat(heightInput.value);
            if (!isNaN(newHeight) && newHeight > 0) {
                vehicleHeight = newHeight;
                updateVehicleDisplay();
                vehicleModal.classList.remove('active');
                updateTestDisplay();
            } else {
                alert('Please enter a valid height in feet');
            }
        });

        vehicleModal.addEventListener('click', (e) => {
            if (e.target === vehicleModal) {
                vehicleModal.classList.remove('active');
            }
        });

        function updateVehicleDisplay() {
            vehicleSpec.textContent = `Height: ${vehicleHeight.toFixed(1)} feet`;
            vehicleClearanceValue.textContent = `${vehicleHeight.toFixed(1)}'`;
        }

        function updateTestDisplay() {
            const scenario = testScenarios[testMode];
            const currentHeading = 45; // Fixed heading for demo
            
            // Update compass rose rotation
            persistentCompassRose.style.transform = `rotate(${-currentHeading}deg)`;
            persistentHeadingArrow.style.transform = `translate(-50%, -100%) rotate(0deg)`;
            
            if (scenario.level) {
                // Show alert
                const relativeBearing = scenario.bearing - currentHeading;
                
                persistentBridgeArrow.style.display = 'block';
                persistentBridgeArrow.style.transform = `translate(-50%, -100%) rotate(${relativeBearing}deg)`;
                persistentBridgeArrow.className = `compass-bridge-arrow ${scenario.level}`;
                
                persistentCompassInfo.style.display = 'block';
                persistentDistance.textContent = `${scenario.distance.toFixed(1)} mi`;
                persistentDistance.classList.add('alert');
                persistentBearing.textContent = `${scenario.bearing}° ${getCardinalDirection(scenario.bearing)}`;
                
                compassStatus.textContent = 'Bridge Alert';
                compassStatus.classList.add('alert');
                statusPulse.classList.add('alert');
                
                compassLocationInfo.style.display = 'none';
                
                bridgeAlertBanner.classList.add('active');
                bridgeAlertBanner.className = `bridge-alert-banner active ${scenario.level}`;
                
                const levelText = {
                    critical: 'CRITICAL ALERT',
                    warning: 'WARNING',
                    caution: 'CAUTION'
                }[scenario.level];
                
                bridgeAlertTitle.textContent = levelText;
                bridgeAlertSubtitle.textContent = `${scenario.distance.toFixed(1)} miles - ${scenario.bridge.name}`;
                
                bridgeDetails.classList.add('active');
                bridgeDetails.className = `bridge-details active ${scenario.level}`;
                bridgeNameCompact.textContent = scenario.bridge.name;
                bridgeDistanceCompact.textContent = `${scenario.distance.toFixed(1)} mi`;
                bridgeClearanceValue.textContent = `${scenario.bridge.clearance}'`;
                
                const diff = vehicleHeight - scenario.bridge.clearance;
                overByValue.textContent = `+${diff.toFixed(1)}'`;
                
                const actionText = {
                    critical: 'STOP - REROUTE IMMEDIATELY',
                    warning: 'PREPARE TO REROUTE',
                    caution: 'CAUTION - MONITOR ROUTE'
                }[scenario.level];
                
                alertActionCompact.textContent = actionText;
                
                persistentCompass.className = `persistent-compass bridge-detected ${scenario.level}`;
                
                allClearMessage.classList.remove('active');
            } else {
                // Show all clear
                persistentBridgeArrow.style.display = 'none';
                persistentCompassInfo.style.display = 'none';
                persistentDistance.classList.remove('alert');
                compassStatus.textContent = 'Monitoring';
                compassStatus.classList.remove('alert');
                statusPulse.classList.remove('alert');
                bridgeAlertBanner.classList.remove('active');
                bridgeDetails.classList.remove('active');
                persistentCompass.className = 'persistent-compass';
                
                allClearMessage.classList.add('active');
                compassLocationInfo.style.display = 'grid';
            }
        }

        function getCardinalDirection(heading) {
            const directions = ['N', 'NE', 'E', 'SE', 'S', 'SW', 'W', 'NW'];
            const index = Math.round(((heading % 360) / 45)) % 8;
            return directions[index];
        }

        // Initialize display
        updateVehicleDisplay();
        updateTestDisplay();
    </script>
</body>
</html>
